---
title: "Proposal"
author: "Michelle Kelly"
date: "July 16, 2018"
output: pdf_document
---

```{r setup, echo = FALSE, warning = FALSE, message = FALSE}
# streamPULSE pipeline tools
#library(devtools)
#install_github('streampulse/StreamPULSE', dependencies=TRUE)

# Latest version of streamMetabolizer
#install.packages("streamMetabolizer", dependencies = TRUE, 
#                 repos = c("https://owi.usgs.gov/R", "https://cran.rstudio.com"))

library(lubridate)
#library(StreamPULSE)
library(streamMetabolizer)
library(imputeTS)
library(ggplot2)
```

# Introduction  
# Methods  
- describe USGS data and how you collected it
- description of why certain sites were chosen  
    - explain that for the purposes of proposal, model was evaluated for only one of the sites
- description of methods used to model metabolism  

# Results  
- present results of modeling from one site as a preliminary result  
# Discussion  
- connect the results back to metabolism regime work done by bernhardt et al 2018, etc
- describe plans for final project

```{r data.import, cache = TRUE, echo = FALSE, warning = FALSE}
# for this proposal, pull one USGS site
# full project will do comparison between sites of different conditions: tropical rivers, artic rivers, heavy agricultural rivers, arid rivers

source("dataLoad.R")

# notes for Tests.Rmd
#     verify input is in correct format:
#         - verify column names are as expected

# large, aseasonal, little canopy cover: loading CA sacramento data
filepath_CA <- "./data_files/CA_SacramentoR.csv"
lat_CA <- "38.257778"
long_CA <- "-121.517222"
tz_CA <- "America/Los_Angeles"
CA_SacramentoR <- dataLoad(filepath = filepath_CA, lat = lat_CA, long = long_CA, tz = tz_CA)

# small, seasonal, and forested: loading CT data
filepath_CT <- "./data_files/CT_NorthBranchParkR.csv"
lat_CT <- "41.784439"
long_CT <- "-72.708056"
tz_CT <- "America/New_York"
CT_NorthBranch <- dataLoad(filepath = filepath_CT, lat = lat_CT, long = long_CT, tz = tz_CT)

# large, seasonal, agriculturally dominated: Mississippi R at Clinton IA
# gage # 05420500
filepath_IA <- "./data_files/IA_MississippiR.csv"
lat_IA <- "41.780556"
long_IA <- "-90.251944"
tz_IA <- "America/Chicago"
IA_MississippiR <- dataLoad(filepath = filepath_IA, lat = lat_IA, long = long_IA, tz = tz_IA)
```

```{r dataPrep, echo = FALSE, warning = FALSE, message = FALSE}
# notes for Tests.Rmd
#     verify input is in correct format:
#         - verify column names are as expected
#         - verify column classes are as expected
source("dataPrep.R")
IA_MississippiR <- dataPrep(IA_MississippiR)
```

```{r modeling, cache = TRUE, echo = FALSE, message = FALSE}
# notes for Tests.rmd
#     verify input is in correct format:
#       - verify column names are as expected (check that data has passed through dataPrep)
#       - verify no NA values in any columns
source("metabolismModeling.R")
metabModel.IA_MississippiR <- metabolismModeling(IA_MississippiR,
                                                 "IA_MississippiR_MetabolismModel.csv")
str(metabModel.IA_MississippiR)
```

```{r plotting, fig.height=4, fig.width = 8, echo = FALSE, warning = FALSE}
# have a very short function that plots
source("metabolismPlot.R")
metabolismPlot(metabModel.IA_MississippiR, filename = "IA_MississippiR_MetabolismModel.png") # model is not totally complete, visually check over input data to improve model output. I think this example is fine for the purposes of the proposal, however.
```