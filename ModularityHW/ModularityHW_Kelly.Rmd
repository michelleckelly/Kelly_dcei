---
title: "ModularityHW_Kelly"
author: "Michelle Kelly"
date: "June 4, 2018"
output: 
  pdf_document:
    theme: yeti
    df_print: paged
    toc: yes
    number_sections: true
---  

<!--R setup chunk (Modularity lesson #8, noting the exact purpose of each Rmd chunk)-->
```{r setup, echo=FALSE, message=FALSE, error=FALSE, warning=FALSE}
### Global options ###
# Enable caching in all chunks
# Set default size of figures to 5x7
knitr::opts_chunk$set(fig.height = 5, fig.width = 9, cache=TRUE)

### Packages ###
library(ggplot2)
library(data.table)
library(reshape2)
```

***  

# Abstract  

(you will have to write this) climate change, long term trends, etc  

***  

# Introduction  

research questions:  
(1) can we see climate warming for ourselves by analyzing this data?  
(2) in what parts of the country are temperatures getting warmer? are there parts of the country where temperatures became colder?  
(3) can we say, based on this data, what change has occured in precipitation over the period?  

***

# Methods  

***

# Results  

```{r dataImport, echo=FALSE}
# Dependencies: 
#   Text files:
#     USAAnnualPcpn1950_2008.rds
#     USAAnnualTemp1950_2008.rds

# Variable definitions: 
#     precip <- annual precipitation data for USA, loaded from USAAnnualPcpn1950_2008.rds
#     temp <- annual temperature data for USA, loaded from USAAnnualTemp1950_2008.rds
#     provided <- TRUE if data loaded from file, 
#                 FALSE if data pulled from API

provided <- TRUE # (modularity lesson #1)

if (provided == TRUE){
  precip <- readRDS(file = "USAAnnualPcpn1950_2008.rds")
  temp <- readRDS(file = "USAAnnualTemp1950_2008.rds")
}
```

```{r dataCleanup, echo=FALSE}
# Dependencies:
#     dataImport

# Variable definitions:
#     minimumTimespan <- numeric, minimum years of data each station must have

minimumTimespan <- 40 # years

# Pseudocode for trimming function (modularity lesson #7)
# trim <- function(dataset, minimumTimespan){
#   for (each unique station){
#     find out how many years of data that station has:
#       count number of non-NA values in $data 
#     if (years of data > 40){
#       trimmedDataframe <- (add unique station to dataframe)
#     }
#   }
# return(trimmedDataframe)
# }

# modularity lesson 2: write extensible code by creating trimming function
# Input variables:
#     dataset <- the data.frame that you want to trim
#     minTime <- minimum years of data each station must have
# Inner variables:
#     trimmedDataframe <- skeleton dataframe, to be filled by trim function
# Output variables:
#     trimmedDataframe <- data.frame of stations that have data for >= minTime
trim <- function(dataset, minTime){
  trimmedDataframe <- data.frame(
  state = factor(),
  name = factor(),
  lon = numeric(),
  lat = numeric(),
  data = numeric(),
  year = integer()
  )
  for(stationNumber in 1:length(unique(dataset$name))){
    stationData <- subset(dataset, dataset$name == unique(dataset$name)[stationNumber])
    stationTimespan <- length(na.omit(stationData$data))
    if (stationTimespan >= minTime){
      trimmedDataframe <- rbindlist(list(trimmedDataframe, stationData))
    }
  }
  return(trimmedDataframe)
}

precip <- trim(precip, minimumTimespan)
temp <- trim(temp, minimumTimespan) # very slow. find a way to fix

# convert dataframe into matrix form
matricize <- function(dataframe){
  dataframe <- matrix(data = dataframe$data,
                             nrow = length(unique(dataframe$year)),
                             ncol = length(unique(dataframe$name)),
                             dimnames = list(unique(dataframe$year),
                                             unique(dataframe$name)))
  return(dataframe)
}

precip_matrix <- matricize(precip)
temp_matrix <- matricize(temp)
```

```{r dataVis_temp, echo=FALSE}

```

```{r dataVis_precip, echo=FALSE}
# significance testing: does basic trend change with time?
signiftest_precip <- lm(precip$data ~ precip$year)
summary(signiftest_precip)

# plotting data with trendline
matplot(x = names(precip_matrix[,1]), y = precip_matrix, 
        type = "l", xlab = "Year", ylab = "Average annual precipitation, inches",
        col = rgb(0, 0, (1:10)/10), lty = 1)
abline(signiftest_precip, col = "red")
```

# Discussion

# References
